## 204. 计数质数

给定整数 n ，返回 所有小于非负整数 n 的质数的数量 。

 

示例 1：  

>输入：n = 10  
>输出：4  
>解释：小于 10 的质数一共有 4 个, 它们是 2, 3, 5, 7 。  

示例 2：  

>输入：n = 0  
>输出：0  

示例 3：  

>输入：n = 1  
>输出：0  
 

提示：

- 0 <= n <= 5 * $10^6$

## 题解

### 解法一、逐个判定+优化

```java
class Solution {
    public static boolean isPrime(int n) {
        if (n <= 3) {
            return n > 1;
        }
        // 只有6x-1和6x+1的数才有可能是质数
        if (n % 6 != 1 && n % 6 != 5) {
            return false;
        }
        // 判断这些数能否被小于sqrt(n)的奇数整除
        int sqrt = (int) Math.sqrt(n);
        for (int i = 5; i <= sqrt; i += 6) {
            if (n % i == 0 || n % (i + 2) == 0) {
                return false;
            }
        }
        return true;
    }

    public int countPrimes(int n) {
        int ans = 0;
        if (n > 2) ++ans;
        for (int i = 3; i < n; i += 2) {
            if (isPrime(i)) ++ans;
        }
        return ans;
    }
}
```

### 解法二、埃氏筛

```java
class Solution {
    // 遍历从2到n的每一个数x
    // 如果x是质数，它的倍数必定是合数，将所有x的倍数标记
    // 合理性证明：遍历到x时，如果x被标记，则x是某个质数的倍数，x为合数；
    // x未被标记，x没有2到x内任何质因数，x为质数
    public int countPrimes(int n) {
        boolean[] isPrimes = new boolean[n + 1];
        Arrays.fill(isPrimes, true);
        int ans = 0;
        for (int i = 2; i < n; i++) {
            if (!isPrimes[i]) continue;
            ans++;
            if ((long)i * i >= n) continue;
            // 优化，小于i*i的数已经被更小的质数标记，从i*i开始每个数只标记一次
            for (int j = i * i; j < n; j += i) {
                isPrimes[j] = false;
            }
        }
        return ans;
    }
}
```