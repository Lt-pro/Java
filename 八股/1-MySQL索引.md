# MySQL索引

## 一、为什么要使用MySQL索引?他有什么优缺点？

### 优点

- 使用索引可以大大加快数据的检索速度，这是创建索引最主要的原因。
- 通过创建唯一性索引可以保证数据库表中每一行数据的唯一性。

### 缺点

- 创建和维护索引需要耗费许多时间。党对表中数据进行增删改的时候，如果数据中有索引，那么索引也需要动态的修改，会降低SQL的执行效率。
- 索引需要使用物理文件进行存储，会耗费一定存储空间。

## 二、索引常见的底层数据结构

### Hash表

哈希表是键值对的集合，通过键(key)可以快随取出对应的值(value)，因此哈希表可以实现快速检索数据。通过哈希算法可以以O(1)时间复杂度找到key对应的的index，进而找到对应的value。哈希算法存在哈希冲突问题，即多个不同的key具有相同的index，常见解决方案是使用链地址法。

Hash索引不支持顺序和范围查询。


### 二叉查找树(BST)

二叉查找树是一种基于二叉树的数据结构，它具有以下特点：

1. 左子树所有结点的值均小于根节点的值。
2. 右子树所有结点的值均大于根节点的值。
3. 左右子树也分别是二叉查找树。

当二叉查找树是平衡的时候，即树的每个节点左右子树深度相差不超过1，查询时间复杂度为O(log(n))。但在不平衡时，例如在最坏情况下树会退化成线性链表，导致查询效率急剧下降，时间复杂度退化为O(n)。二叉查找树的性能非常依赖于它的平衡程度，这导致其不适合作为MySQL底层索引的数据结构。

### AVL树

AVL树是计算机科学中最早被发明的自平衡二叉查找树，它的特点是保证任何节点的左右子树高度差不超过1，因此也被称为高度平衡二叉树，他的查找、插入和删除在平均和最坏情况下的时间复杂度都是O(log(n))。

AVL树采用旋转操作保持平衡，主要有四种旋转操作：LL旋转、RR旋转、LR旋转和RL旋转。

由于AVL树需要频繁地进行旋转操作来保持平衡，因此会有较大的计算开销进而降低了查询性能。并且在使用AVL树时，每个节点仅存出一个数据，每次磁盘IO只能读取一个节点的数据，如果需要查询的数据分布在多个节点上，那就需要多次磁盘IO。

### 红黑树

红黑树是一种自平衡二叉查找树，通过在插入和删除结点时进行颜色变换和旋转操作，使得树始终保持平衡状态，它具有以下特点：

1. 每个节点非红即黑。
2. 根节点一定是黑色。
3. 每个叶子节点都是黑色的空节点(NIL节点)。
4. 每个红色节点的子节点必定是黑色节点。
5. 非叶子结点到叶子节点的所有简单路径必须包含相同数目的黑色节点。

红黑树的非叶子节点到叶子节点的最长路径的长度至多是最短路径的两倍。TreeMap、TreeSet以及JDK1.8的HashMap底层都使用了红黑树，对于数据在内存中的情况来说，红黑树的表现是非常优秀的。

### B树&B+树

B树也称B-树，全称为多路平衡查找树，B+树是B树的一种变体。B树和B+树中的B是Balance的意思。

目前大部分数据库系统以及文件系统都采用B-Tree或其变种B+Tree作为索引结构。

B树和B+树有何异同呢？

- B树的所有节点既存放键(key)也存放数据(data)，而B+树只有叶子节点存放key和data，其它节点只存放key。
- B树的叶子结点都是独立的，B+树的叶子结点有一条引用链指向与它相邻的叶子节点。
- B树的检索过程相当于对范围内的每个节点的关键字做二分查找，可能还没有到达叶子节点，检索就结束了。而B+树的检索效率就很稳定了，任何查找都是从根节点到叶子节点的过程，叶子结点的顺序检索很明显。
- 在B树中进行范围查询时，首先要找到查找的下限，然后对B树进行中序遍历，直到找到查找的上限；而B+树的查询范围只需要对链表进行遍历即可。

综上，B+树与B树相比，具备更少的IO次数、更稳定的查询效率和更适于范围查询这些优势。


